<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Retbro Generator</title>
<style>
  :root {
    --bg-color: #1e1e2f;
    --card-color: #2c2c3c;
    --text-color: #f0f0f0;
    --accent-color: #4f9dff;
    --hover-color: #3a3a50;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 30px;
  }

  .top-bar {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 20px;
  }

  input[type=text] {
    padding: 8px;
    border-radius: 5px;
    border: none;
    width: 200px;
    outline: none;
  }

  button {
    cursor: pointer;
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    background-color: var(--accent-color);
    color: white;
    transition: 0.2s;
  }

  button:hover {
    background-color: #357edb;
  }

  #systemsContainer {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .system-card {
    background: var(--card-color);
    border-radius: 10px;
    overflow: hidden;
    transition: 0.3s;
  }

  .system-header {
    padding: 12px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    user-select: none;
  }

  .system-header:hover {
    background: var(--hover-color);
  }

  .links-list {
    list-style: none;
    padding: 0 20px 12px 20px;
    margin: 0;
    display: none;
  }

  .links-list li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    gap: 5px;
  }

  .links-list a {
    color: var(--accent-color);
    text-decoration: none;
    word-break: break-all;
    flex: 1;
  }

  .links-list a:hover {
    text-decoration: underline;
  }

  .file-input {
    display: none;
  }
</style>
</head>
<body>

<h1>Retbro retbrorl generator</h1>

<div class="top-bar">
  <input type="text" id="newSystemName" placeholder="Enter system name">
  <button onclick="addSystem()">+ Add System</button>
  <button onclick="exportJSON()">Export .retbrorl</button>
  <button onclick="document.getElementById('fileInput').click()">Import .retbrorl</button>
  <input type="file" id="fileInput" class="file-input" accept=".retbrorl" onchange="importJSON(event)">
</div>

<div id="systemsContainer"></div>

<script>
let systems = {};

// Add system
function addSystem() {
  const systemName = document.getElementById('newSystemName').value.trim();
  if (!systemName) return alert("Please enter a system name!");
  if (systems[systemName]) return alert("System already exists!");

  systems[systemName] = { sys_image: "", roms: [] };
  document.getElementById('newSystemName').value = '';
  renderSystems();
}

// Edit system name
function editSystemName(oldName) {
  const newName = prompt("Enter new name for system:", oldName);
  if (!newName) return;
  if (systems[newName] && newName !== oldName) return alert("System name already exists!");
  systems[newName] = systems[oldName];
  delete systems[oldName];
  renderSystems();
}

// Set system image
function setSystemImage(systemName) {
  const url = prompt("Enter image URL for " + systemName + ":", systems[systemName].sys_image);
  if (url === null) return;
  systems[systemName].sys_image = url;
  renderSystems();
}

// Add ROM
function addLink(systemName) {
  const url = prompt("Enter ROM link for " + systemName + ":");
  if (!url) return;
  systems[systemName].roms.push(url);
  renderSystems();
}

// Edit ROM
function editLink(systemName, index) {
  const newUrl = prompt("Edit ROM link for " + systemName + ":", systems[systemName].roms[index]);
  if (!newUrl) return;
  systems[systemName].roms[index] = newUrl;
  renderSystems();
}

// Remove ROM
function removeLink(systemName, index) {
  systems[systemName].roms.splice(index, 1);
  renderSystems();
}

// Toggle dropdown
function toggleSystem(systemName) {
  const list = document.getElementById('links-' + systemName);
  list.style.display = list.style.display === 'block' ? 'none' : 'block';
}

// Render all systems
function renderSystems() {
  const container = document.getElementById('systemsContainer');
  container.innerHTML = '';

  for (const systemName in systems) {
    const sysData = systems[systemName];

    const card = document.createElement('div');
    card.className = 'system-card';

    card.innerHTML = `
      <div class="system-header" onclick="toggleSystem('${systemName}')">
        <h2>${systemName}</h2>
        <div>
          <button onclick="event.stopPropagation(); addLink('${systemName}')">+ Add ROM</button>
          <button onclick="event.stopPropagation(); setSystemImage('${systemName}')">Set Image</button>
          <button onclick="event.stopPropagation(); editSystemName('${systemName}')">Edit Name</button>
        </div>
      </div>
      ${sysData.sys_image ? `<img src="${sysData.sys_image}" alt="${systemName}" style="max-width:100%; display:block; margin:auto;">` : ''}
      <ul class="links-list" id="links-${systemName}">
        ${sysData.roms.map((link, i) => `
          <li>
            <a href="${link}" target="_blank">${link}</a>
            <button onclick="event.stopPropagation(); editLink('${systemName}', ${i})">Edit</button>
            <button onclick="event.stopPropagation(); removeLink('${systemName}', ${i})">Delete</button>
          </li>
        `).join('')}
      </ul>
    `;

    container.appendChild(card);
  }
}

// Export JSON
function exportJSON() {
  const dataStr = JSON.stringify(systems, null, 2);
  const blob = new Blob([dataStr], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement('a');
  a.href = url;
  a.download = 'roms.retbrorl';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// Import JSON
function importJSON(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const importedData = JSON.parse(e.target.result);
      systems = importedData;
      renderSystems();
    } catch (err) {
      alert("Invalid .retbrorl file!");
    }
  };
  reader.readAsText(file);
}

// Example
systems = {
  "Nintendo Entertainment System": {
    sys_image: "https://example.com/nes-image.png",
    roms: ["rom1.nes", "rom2.nes"]
  },
  "Super Nintendo": {
    sys_image: "https://example.com/snes-image.png",
    roms: ["rom1.smc", "rom2.smc"]
  }
};

renderSystems();
</script>

</body>
</html>